set(CPU6502_TESTS_TARGET_NAME cpu6502_tests)

set(CPU6502_TESTS_SOURCES
    ${CMAKE_CURRENT_SOURCE_DIR}/CMakeLists.txt
    ${CMAKE_CURRENT_SOURCE_DIR}/cpu6502_tests.cpp
)

add_executable(${CPU6502_TESTS_TARGET_NAME}
    ${CPU6502_TESTS_SOURCES}
    ${CMAKE_SOURCE_DIR}/shared/file_io.cpp
)
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR} PREFIX source FILES ${CPU6502_TESTS_SOURCES})

target_link_libraries(${CPU6502_TESTS_TARGET_NAME} PRIVATE
    ${CPU6502_LIB_TARGET_NAME}
    gtest
    gtest_main
)

set_target_properties(${CPU6502_TESTS_TARGET_NAME} PROPERTIES
    VS_DEBUGGER_WORKING_DIRECTORY $<TARGET_FILE_DIR:${CPU6502_TESTS_TARGET_NAME}>
    FOLDER shared/6502
)

add_custom_command(
    TARGET ${CPU6502_TESTS_TARGET_NAME}
    POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy_directory ${CMAKE_SOURCE_DIR}/third_party/6502_test_roms $<TARGET_FILE_DIR:${CPU6502_TESTS_TARGET_NAME}>/test_files/6502
)
